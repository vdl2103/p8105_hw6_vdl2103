p8105 Homework 6
================
Tory Lynch
November 26, 2018

#### Problem 1

``` r
#Load and clean data 
homicide_data = read_csv("data/homicide-data.csv", na = c("", "NA", "Unknown")) %>% 
  mutate(
    city_state = str_c(city, state, sep = ", "), 
    resolution = case_when(
      disposition == "Closed without arrest" ~ "unsolved", 
      disposition == "Open/No arrest" ~ "unsolved", 
      disposition == "Closed by arrest" ~ "solved"
    )
  ) %>% 
  filter(!city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")) %>% 
  mutate(
    race = as.factor(case_when(
      victim_race == "White" ~ "white", 
      victim_race != "White" ~ "non-white"
    ))
  ) %>% 
  mutate(age = as.numeric(victim_age)) %>% 
  mutate(race = fct_relevel(race, "white")) %>% 
  mutate(sex = fct_relevel(victim_sex, "Female")) %>% 
  mutate(resolution = fct_relevel(resolution, "unsolved"))
```

##### Logistic model for Baltimore, MD

``` r
logistic_model = homicide_data %>% 
  filter(city_state == "Baltimore, MD") %>% 
  glm(resolution ~ age + sex + race, data = ., family = binomial())

logistic_model %>% 
  broom::tidy(., conf.int = TRUE) %>% 
  mutate(
    OR = exp(estimate), 
    ci.high = exp(conf.high),
    ci.low = exp(conf.low)
  ) %>% 
  dplyr::select(term, OR, ci.high, ci.low) %>% 
 knitr:: kable(digits = 4)
```

<table>
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
OR
</th>
<th style="text-align:right;">
ci.high
</th>
<th style="text-align:right;">
ci.low
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
3.2741
</td>
<td style="text-align:right;">
5.2122
</td>
<td style="text-align:right;">
2.0760
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
0.9930
</td>
<td style="text-align:right;">
0.9994
</td>
<td style="text-align:right;">
0.9867
</td>
</tr>
<tr>
<td style="text-align:left;">
sexMale
</td>
<td style="text-align:right;">
0.4116
</td>
<td style="text-align:right;">
0.5369
</td>
<td style="text-align:right;">
0.3148
</td>
</tr>
<tr>
<td style="text-align:left;">
racenon-white
</td>
<td style="text-align:right;">
0.4406
</td>
<td style="text-align:right;">
0.6197
</td>
<td style="text-align:right;">
0.3122
</td>
</tr>
</tbody>
</table>
##### Logistic model for all cities

###### Adjusted for age and sex

``` r
#Model adjusted for age and sex
nested_adjusetd_homicide = homicide_data %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(model = map(data, ~glm(resolution ~ race + age + sex, data = ., family = binomial())),
         model = map(model, broom::tidy, conf.int = TRUE)) %>% 
  dplyr::select(-data) %>%    
  unnest() %>% 
  mutate(
    OR = exp(estimate), 
    ci.high = exp(conf.high),
    ci.low = exp(conf.low)
  ) %>% 
  filter(term == "racenon-white") %>% 
  dplyr::select(city_state, OR, ci.high, ci.low) 

  nested_adjusetd_homicide %>% 
    knitr::kable(digits = 3, 
               col.names = c("City", "OR", "High CI", "Low CI"))
```

<table>
<thead>
<tr>
<th style="text-align:left;">
City
</th>
<th style="text-align:right;">
OR
</th>
<th style="text-align:right;">
High CI
</th>
<th style="text-align:right;">
Low CI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Albuquerque, NM
</td>
<td style="text-align:right;">
0.739
</td>
<td style="text-align:right;">
1.220
</td>
<td style="text-align:right;">
0.445
</td>
</tr>
<tr>
<td style="text-align:left;">
Atlanta, GA
</td>
<td style="text-align:right;">
0.753
</td>
<td style="text-align:right;">
1.299
</td>
<td style="text-align:right;">
0.424
</td>
</tr>
<tr>
<td style="text-align:left;">
Baltimore, MD
</td>
<td style="text-align:right;">
0.441
</td>
<td style="text-align:right;">
0.620
</td>
<td style="text-align:right;">
0.312
</td>
</tr>
<tr>
<td style="text-align:left;">
Baton Rouge, LA
</td>
<td style="text-align:right;">
0.668
</td>
<td style="text-align:right;">
1.405
</td>
<td style="text-align:right;">
0.304
</td>
</tr>
<tr>
<td style="text-align:left;">
Birmingham, AL
</td>
<td style="text-align:right;">
1.039
</td>
<td style="text-align:right;">
1.754
</td>
<td style="text-align:right;">
0.612
</td>
</tr>
<tr>
<td style="text-align:left;">
Boston, MA
</td>
<td style="text-align:right;">
0.127
</td>
<td style="text-align:right;">
0.285
</td>
<td style="text-align:right;">
0.047
</td>
</tr>
<tr>
<td style="text-align:left;">
Buffalo, NY
</td>
<td style="text-align:right;">
0.392
</td>
<td style="text-align:right;">
0.714
</td>
<td style="text-align:right;">
0.211
</td>
</tr>
<tr>
<td style="text-align:left;">
Charlotte, NC
</td>
<td style="text-align:right;">
0.558
</td>
<td style="text-align:right;">
0.951
</td>
<td style="text-align:right;">
0.313
</td>
</tr>
<tr>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:right;">
0.562
</td>
<td style="text-align:right;">
0.734
</td>
<td style="text-align:right;">
0.432
</td>
</tr>
<tr>
<td style="text-align:left;">
Cincinnati, OH
</td>
<td style="text-align:right;">
0.318
</td>
<td style="text-align:right;">
0.541
</td>
<td style="text-align:right;">
0.180
</td>
</tr>
<tr>
<td style="text-align:left;">
Columbus, OH
</td>
<td style="text-align:right;">
0.861
</td>
<td style="text-align:right;">
1.161
</td>
<td style="text-align:right;">
0.638
</td>
</tr>
<tr>
<td style="text-align:left;">
Denver, CO
</td>
<td style="text-align:right;">
0.602
</td>
<td style="text-align:right;">
1.008
</td>
<td style="text-align:right;">
0.358
</td>
</tr>
<tr>
<td style="text-align:left;">
Detroit, MI
</td>
<td style="text-align:right;">
0.652
</td>
<td style="text-align:right;">
0.870
</td>
<td style="text-align:right;">
0.488
</td>
</tr>
<tr>
<td style="text-align:left;">
Durham, NC
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:right;">
2.452
</td>
<td style="text-align:right;">
0.390
</td>
</tr>
<tr>
<td style="text-align:left;">
Fort Worth, TX
</td>
<td style="text-align:right;">
0.838
</td>
<td style="text-align:right;">
1.264
</td>
<td style="text-align:right;">
0.553
</td>
</tr>
<tr>
<td style="text-align:left;">
Fresno, CA
</td>
<td style="text-align:right;">
0.445
</td>
<td style="text-align:right;">
0.841
</td>
<td style="text-align:right;">
0.221
</td>
</tr>
<tr>
<td style="text-align:left;">
Houston, TX
</td>
<td style="text-align:right;">
0.873
</td>
<td style="text-align:right;">
1.090
</td>
<td style="text-align:right;">
0.698
</td>
</tr>
<tr>
<td style="text-align:left;">
Indianapolis, IN
</td>
<td style="text-align:right;">
0.505
</td>
<td style="text-align:right;">
0.665
</td>
<td style="text-align:right;">
0.381
</td>
</tr>
<tr>
<td style="text-align:left;">
Jacksonville, FL
</td>
<td style="text-align:right;">
0.658
</td>
<td style="text-align:right;">
0.862
</td>
<td style="text-align:right;">
0.502
</td>
</tr>
<tr>
<td style="text-align:left;">
Las Vegas, NV
</td>
<td style="text-align:right;">
0.763
</td>
<td style="text-align:right;">
0.981
</td>
<td style="text-align:right;">
0.591
</td>
</tr>
<tr>
<td style="text-align:left;">
Long Beach, CA
</td>
<td style="text-align:right;">
0.794
</td>
<td style="text-align:right;">
1.606
</td>
<td style="text-align:right;">
0.379
</td>
</tr>
<tr>
<td style="text-align:left;">
Los Angeles, CA
</td>
<td style="text-align:right;">
0.666
</td>
<td style="text-align:right;">
0.916
</td>
<td style="text-align:right;">
0.481
</td>
</tr>
<tr>
<td style="text-align:left;">
Louisville, KY
</td>
<td style="text-align:right;">
0.392
</td>
<td style="text-align:right;">
0.590
</td>
<td style="text-align:right;">
0.257
</td>
</tr>
<tr>
<td style="text-align:left;">
Memphis, TN
</td>
<td style="text-align:right;">
0.778
</td>
<td style="text-align:right;">
1.154
</td>
<td style="text-align:right;">
0.516
</td>
</tr>
<tr>
<td style="text-align:left;">
Miami, FL
</td>
<td style="text-align:right;">
0.577
</td>
<td style="text-align:right;">
0.885
</td>
<td style="text-align:right;">
0.376
</td>
</tr>
<tr>
<td style="text-align:left;">
Milwaukee, wI
</td>
<td style="text-align:right;">
0.632
</td>
<td style="text-align:right;">
0.982
</td>
<td style="text-align:right;">
0.398
</td>
</tr>
<tr>
<td style="text-align:left;">
Minneapolis, MN
</td>
<td style="text-align:right;">
0.646
</td>
<td style="text-align:right;">
1.204
</td>
<td style="text-align:right;">
0.341
</td>
</tr>
<tr>
<td style="text-align:left;">
Nashville, TN
</td>
<td style="text-align:right;">
0.902
</td>
<td style="text-align:right;">
1.239
</td>
<td style="text-align:right;">
0.655
</td>
</tr>
<tr>
<td style="text-align:left;">
New Orleans, LA
</td>
<td style="text-align:right;">
0.467
</td>
<td style="text-align:right;">
0.739
</td>
<td style="text-align:right;">
0.295
</td>
</tr>
<tr>
<td style="text-align:left;">
New York, NY
</td>
<td style="text-align:right;">
0.532
</td>
<td style="text-align:right;">
0.989
</td>
<td style="text-align:right;">
0.271
</td>
</tr>
<tr>
<td style="text-align:left;">
Oakland, CA
</td>
<td style="text-align:right;">
0.213
</td>
<td style="text-align:right;">
0.418
</td>
<td style="text-align:right;">
0.099
</td>
</tr>
<tr>
<td style="text-align:left;">
Oklahoma City, OK
</td>
<td style="text-align:right;">
0.681
</td>
<td style="text-align:right;">
0.970
</td>
<td style="text-align:right;">
0.477
</td>
</tr>
<tr>
<td style="text-align:left;">
Omaha, NE
</td>
<td style="text-align:right;">
0.170
</td>
<td style="text-align:right;">
0.300
</td>
<td style="text-align:right;">
0.091
</td>
</tr>
<tr>
<td style="text-align:left;">
Philadelphia, PA
</td>
<td style="text-align:right;">
0.644
</td>
<td style="text-align:right;">
0.850
</td>
<td style="text-align:right;">
0.485
</td>
</tr>
<tr>
<td style="text-align:left;">
Pittsburgh, PA
</td>
<td style="text-align:right;">
0.282
</td>
<td style="text-align:right;">
0.485
</td>
<td style="text-align:right;">
0.157
</td>
</tr>
<tr>
<td style="text-align:left;">
Richmond, VA
</td>
<td style="text-align:right;">
0.447
</td>
<td style="text-align:right;">
1.150
</td>
<td style="text-align:right;">
0.144
</td>
</tr>
<tr>
<td style="text-align:left;">
San Antonio, TX
</td>
<td style="text-align:right;">
0.689
</td>
<td style="text-align:right;">
1.026
</td>
<td style="text-align:right;">
0.459
</td>
</tr>
<tr>
<td style="text-align:left;">
Sacramento, CA
</td>
<td style="text-align:right;">
0.781
</td>
<td style="text-align:right;">
1.348
</td>
<td style="text-align:right;">
0.443
</td>
</tr>
<tr>
<td style="text-align:left;">
Savannah, GA
</td>
<td style="text-align:right;">
0.605
</td>
<td style="text-align:right;">
1.277
</td>
<td style="text-align:right;">
0.279
</td>
</tr>
<tr>
<td style="text-align:left;">
San Bernardino, CA
</td>
<td style="text-align:right;">
0.880
</td>
<td style="text-align:right;">
1.999
</td>
<td style="text-align:right;">
0.394
</td>
</tr>
<tr>
<td style="text-align:left;">
San Diego, CA
</td>
<td style="text-align:right;">
0.483
</td>
<td style="text-align:right;">
0.778
</td>
<td style="text-align:right;">
0.294
</td>
</tr>
<tr>
<td style="text-align:left;">
San Francisco, CA
</td>
<td style="text-align:right;">
0.458
</td>
<td style="text-align:right;">
0.719
</td>
<td style="text-align:right;">
0.288
</td>
</tr>
<tr>
<td style="text-align:left;">
St. Louis, MO
</td>
<td style="text-align:right;">
0.577
</td>
<td style="text-align:right;">
0.819
</td>
<td style="text-align:right;">
0.405
</td>
</tr>
<tr>
<td style="text-align:left;">
Stockton, CA
</td>
<td style="text-align:right;">
0.376
</td>
<td style="text-align:right;">
0.713
</td>
<td style="text-align:right;">
0.193
</td>
</tr>
<tr>
<td style="text-align:left;">
Tampa, FL
</td>
<td style="text-align:right;">
1.159
</td>
<td style="text-align:right;">
2.293
</td>
<td style="text-align:right;">
0.585
</td>
</tr>
<tr>
<td style="text-align:left;">
Tulsa, OK
</td>
<td style="text-align:right;">
0.596
</td>
<td style="text-align:right;">
0.866
</td>
<td style="text-align:right;">
0.406
</td>
</tr>
<tr>
<td style="text-align:left;">
Washington, DC
</td>
<td style="text-align:right;">
0.514
</td>
<td style="text-align:right;">
0.997
</td>
<td style="text-align:right;">
0.252
</td>
</tr>
</tbody>
</table>
``` r
#Plot for adjusted model 
 nested_adjusetd_homicide %>% 
  mutate(city_state = fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = ci.low, ymax = ci.high)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(
    title = "Odds of solving homicides of non-white victims compared to white victims
    in 47 American cities between 2007 - 2015",
    x = "City", 
    y = "Adjusted OR", 
    caption = "Data source: Washington Post
               Model adjusted for race and age"
  )
```

![](p8105_hw6_vdl2103_files/figure-markdown_github/adj%20model%20plot-1.png)

###### Unadjusted model

``` r
#Unadjusted model 
 nested_unadj_homicide = homicide_data %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(model = map(data, ~glm(resolution ~ race, data = ., family = binomial())),
         model = map(model, broom::tidy, conf.int = TRUE)) %>% 
  dplyr::select(-data) %>%    
  unnest() %>% 
  mutate(
    OR = exp(estimate), 
    ci.high = exp(conf.high),
    ci.low = exp(conf.low)
  ) %>% 
  filter(term == "racenon-white") %>% 
  dplyr::select(city_state, OR, ci.high, ci.low) 

nested_unadj_homicide %>% 
  knitr::kable(digits = 3, 
               col.names = c("City", "OR", "High CI", "Low CI"))
```

<table>
<thead>
<tr>
<th style="text-align:left;">
City
</th>
<th style="text-align:right;">
OR
</th>
<th style="text-align:right;">
High CI
</th>
<th style="text-align:right;">
Low CI
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Albuquerque, NM
</td>
<td style="text-align:right;">
0.807
</td>
<td style="text-align:right;">
1.302
</td>
<td style="text-align:right;">
0.499
</td>
</tr>
<tr>
<td style="text-align:left;">
Atlanta, GA
</td>
<td style="text-align:right;">
0.835
</td>
<td style="text-align:right;">
1.425
</td>
<td style="text-align:right;">
0.476
</td>
</tr>
<tr>
<td style="text-align:left;">
Baltimore, MD
</td>
<td style="text-align:right;">
0.386
</td>
<td style="text-align:right;">
0.534
</td>
<td style="text-align:right;">
0.278
</td>
</tr>
<tr>
<td style="text-align:left;">
Baton Rouge, LA
</td>
<td style="text-align:right;">
0.581
</td>
<td style="text-align:right;">
1.181
</td>
<td style="text-align:right;">
0.273
</td>
</tr>
<tr>
<td style="text-align:left;">
Birmingham, AL
</td>
<td style="text-align:right;">
1.128
</td>
<td style="text-align:right;">
1.876
</td>
<td style="text-align:right;">
0.675
</td>
</tr>
<tr>
<td style="text-align:left;">
Boston, MA
</td>
<td style="text-align:right;">
0.098
</td>
<td style="text-align:right;">
0.215
</td>
<td style="text-align:right;">
0.037
</td>
</tr>
<tr>
<td style="text-align:left;">
Buffalo, NY
</td>
<td style="text-align:right;">
0.351
</td>
<td style="text-align:right;">
0.619
</td>
<td style="text-align:right;">
0.194
</td>
</tr>
<tr>
<td style="text-align:left;">
Charlotte, NC
</td>
<td style="text-align:right;">
0.581
</td>
<td style="text-align:right;">
0.960
</td>
<td style="text-align:right;">
0.336
</td>
</tr>
<tr>
<td style="text-align:left;">
Chicago, IL
</td>
<td style="text-align:right;">
0.482
</td>
<td style="text-align:right;">
0.623
</td>
<td style="text-align:right;">
0.373
</td>
</tr>
<tr>
<td style="text-align:left;">
Cincinnati, OH
</td>
<td style="text-align:right;">
0.310
</td>
<td style="text-align:right;">
0.514
</td>
<td style="text-align:right;">
0.180
</td>
</tr>
<tr>
<td style="text-align:left;">
Columbus, OH
</td>
<td style="text-align:right;">
0.740
</td>
<td style="text-align:right;">
0.979
</td>
<td style="text-align:right;">
0.559
</td>
</tr>
<tr>
<td style="text-align:left;">
Denver, CO
</td>
<td style="text-align:right;">
0.597
</td>
<td style="text-align:right;">
0.969
</td>
<td style="text-align:right;">
0.366
</td>
</tr>
<tr>
<td style="text-align:left;">
Detroit, MI
</td>
<td style="text-align:right;">
0.617
</td>
<td style="text-align:right;">
0.819
</td>
<td style="text-align:right;">
0.464
</td>
</tr>
<tr>
<td style="text-align:left;">
Durham, NC
</td>
<td style="text-align:right;">
0.909
</td>
<td style="text-align:right;">
2.079
</td>
<td style="text-align:right;">
0.374
</td>
</tr>
<tr>
<td style="text-align:left;">
Fort Worth, TX
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
1.463
</td>
<td style="text-align:right;">
0.669
</td>
</tr>
<tr>
<td style="text-align:left;">
Fresno, CA
</td>
<td style="text-align:right;">
0.433
</td>
<td style="text-align:right;">
0.798
</td>
<td style="text-align:right;">
0.220
</td>
</tr>
<tr>
<td style="text-align:left;">
Houston, TX
</td>
<td style="text-align:right;">
0.899
</td>
<td style="text-align:right;">
1.115
</td>
<td style="text-align:right;">
0.724
</td>
</tr>
<tr>
<td style="text-align:left;">
Indianapolis, IN
</td>
<td style="text-align:right;">
0.527
</td>
<td style="text-align:right;">
0.683
</td>
<td style="text-align:right;">
0.405
</td>
</tr>
<tr>
<td style="text-align:left;">
Jacksonville, FL
</td>
<td style="text-align:right;">
0.660
</td>
<td style="text-align:right;">
0.850
</td>
<td style="text-align:right;">
0.511
</td>
</tr>
<tr>
<td style="text-align:left;">
Las Vegas, NV
</td>
<td style="text-align:right;">
0.802
</td>
<td style="text-align:right;">
1.013
</td>
<td style="text-align:right;">
0.633
</td>
</tr>
<tr>
<td style="text-align:left;">
Long Beach, CA
</td>
<td style="text-align:right;">
0.631
</td>
<td style="text-align:right;">
1.213
</td>
<td style="text-align:right;">
0.314
</td>
</tr>
<tr>
<td style="text-align:left;">
Los Angeles, CA
</td>
<td style="text-align:right;">
0.611
</td>
<td style="text-align:right;">
0.826
</td>
<td style="text-align:right;">
0.449
</td>
</tr>
<tr>
<td style="text-align:left;">
Louisville, KY
</td>
<td style="text-align:right;">
0.386
</td>
<td style="text-align:right;">
0.564
</td>
<td style="text-align:right;">
0.261
</td>
</tr>
<tr>
<td style="text-align:left;">
Memphis, TN
</td>
<td style="text-align:right;">
0.922
</td>
<td style="text-align:right;">
1.344
</td>
<td style="text-align:right;">
0.622
</td>
</tr>
<tr>
<td style="text-align:left;">
Miami, FL
</td>
<td style="text-align:right;">
0.573
</td>
<td style="text-align:right;">
0.866
</td>
<td style="text-align:right;">
0.380
</td>
</tr>
<tr>
<td style="text-align:left;">
Milwaukee, wI
</td>
<td style="text-align:right;">
0.687
</td>
<td style="text-align:right;">
1.053
</td>
<td style="text-align:right;">
0.439
</td>
</tr>
<tr>
<td style="text-align:left;">
Minneapolis, MN
</td>
<td style="text-align:right;">
0.575
</td>
<td style="text-align:right;">
1.045
</td>
<td style="text-align:right;">
0.310
</td>
</tr>
<tr>
<td style="text-align:left;">
Nashville, TN
</td>
<td style="text-align:right;">
0.920
</td>
<td style="text-align:right;">
1.256
</td>
<td style="text-align:right;">
0.671
</td>
</tr>
<tr>
<td style="text-align:left;">
New Orleans, LA
</td>
<td style="text-align:right;">
0.579
</td>
<td style="text-align:right;">
0.895
</td>
<td style="text-align:right;">
0.375
</td>
</tr>
<tr>
<td style="text-align:left;">
New York, NY
</td>
<td style="text-align:right;">
0.441
</td>
<td style="text-align:right;">
0.799
</td>
<td style="text-align:right;">
0.229
</td>
</tr>
<tr>
<td style="text-align:left;">
Oakland, CA
</td>
<td style="text-align:right;">
0.185
</td>
<td style="text-align:right;">
0.358
</td>
<td style="text-align:right;">
0.087
</td>
</tr>
<tr>
<td style="text-align:left;">
Oklahoma City, OK
</td>
<td style="text-align:right;">
0.685
</td>
<td style="text-align:right;">
0.950
</td>
<td style="text-align:right;">
0.493
</td>
</tr>
<tr>
<td style="text-align:left;">
Omaha, NE
</td>
<td style="text-align:right;">
0.144
</td>
<td style="text-align:right;">
0.249
</td>
<td style="text-align:right;">
0.078
</td>
</tr>
<tr>
<td style="text-align:left;">
Philadelphia, PA
</td>
<td style="text-align:right;">
0.576
</td>
<td style="text-align:right;">
0.753
</td>
<td style="text-align:right;">
0.437
</td>
</tr>
<tr>
<td style="text-align:left;">
Pittsburgh, PA
</td>
<td style="text-align:right;">
0.243
</td>
<td style="text-align:right;">
0.412
</td>
<td style="text-align:right;">
0.138
</td>
</tr>
<tr>
<td style="text-align:left;">
Richmond, VA
</td>
<td style="text-align:right;">
0.494
</td>
<td style="text-align:right;">
1.213
</td>
<td style="text-align:right;">
0.164
</td>
</tr>
<tr>
<td style="text-align:left;">
San Antonio, TX
</td>
<td style="text-align:right;">
0.768
</td>
<td style="text-align:right;">
1.127
</td>
<td style="text-align:right;">
0.518
</td>
</tr>
<tr>
<td style="text-align:left;">
Sacramento, CA
</td>
<td style="text-align:right;">
0.707
</td>
<td style="text-align:right;">
1.195
</td>
<td style="text-align:right;">
0.409
</td>
</tr>
<tr>
<td style="text-align:left;">
Savannah, GA
</td>
<td style="text-align:right;">
0.618
</td>
<td style="text-align:right;">
1.207
</td>
<td style="text-align:right;">
0.308
</td>
</tr>
<tr>
<td style="text-align:left;">
San Bernardino, CA
</td>
<td style="text-align:right;">
0.722
</td>
<td style="text-align:right;">
1.555
</td>
<td style="text-align:right;">
0.340
</td>
</tr>
<tr>
<td style="text-align:left;">
San Diego, CA
</td>
<td style="text-align:right;">
0.472
</td>
<td style="text-align:right;">
0.738
</td>
<td style="text-align:right;">
0.296
</td>
</tr>
<tr>
<td style="text-align:left;">
San Francisco, CA
</td>
<td style="text-align:right;">
0.336
</td>
<td style="text-align:right;">
0.515
</td>
<td style="text-align:right;">
0.216
</td>
</tr>
<tr>
<td style="text-align:left;">
St. Louis, MO
</td>
<td style="text-align:right;">
0.584
</td>
<td style="text-align:right;">
0.822
</td>
<td style="text-align:right;">
0.413
</td>
</tr>
<tr>
<td style="text-align:left;">
Stockton, CA
</td>
<td style="text-align:right;">
0.386
</td>
<td style="text-align:right;">
0.717
</td>
<td style="text-align:right;">
0.203
</td>
</tr>
<tr>
<td style="text-align:left;">
Tampa, FL
</td>
<td style="text-align:right;">
1.131
</td>
<td style="text-align:right;">
2.142
</td>
<td style="text-align:right;">
0.596
</td>
</tr>
<tr>
<td style="text-align:left;">
Tulsa, OK
</td>
<td style="text-align:right;">
0.620
</td>
<td style="text-align:right;">
0.888
</td>
<td style="text-align:right;">
0.430
</td>
</tr>
<tr>
<td style="text-align:left;">
Washington, DC
</td>
<td style="text-align:right;">
0.566
</td>
<td style="text-align:right;">
1.076
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
</tbody>
</table>
``` r
#Unadjusted model plot
  nested_unadj_homicide %>% 
  mutate(city_state = fct_reorder(city_state, OR)) %>% 
  ggplot(aes(x = city_state, y = OR)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = ci.low, ymax = ci.high)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(
    title = "Odds of solving homicides of non-white victims compared to white victims
    in 47 American cities between 2007 - 2015",
    x = "City", 
    y = "OR", 
    caption = "Data source: Washington Post
               Unadjusted model"
  )
```

![](p8105_hw6_vdl2103_files/figure-markdown_github/unadj%20model%20plot-1.png)

``` r
comparison_table = left_join(nested_adjusetd_homicide, nested_unadj_homicide, by = "city_state") %>% 
  mutate(
    City = row.names(.), 
    OR.x = color_tile("red", "white") (OR.x)
    
  )


comparison_table
```

    ## # A tibble: 47 x 8
    ##    city_state  OR.x     ci.high.x ci.low.x   OR.y ci.high.y ci.low.y City 
    ##    <chr>       <chr>        <dbl>    <dbl>  <dbl>     <dbl>    <dbl> <chr>
    ##  1 Albuquerqu… "<span …     1.22    0.445  0.807      1.30    0.499  1    
    ##  2 Atlanta, GA "<span …     1.30    0.424  0.835      1.42    0.476  2    
    ##  3 Baltimore,… "<span …     0.620   0.312  0.386      0.534   0.278  3    
    ##  4 Baton Roug… "<span …     1.41    0.304  0.581      1.18    0.273  4    
    ##  5 Birmingham… "<span …     1.75    0.612  1.13       1.88    0.675  5    
    ##  6 Boston, MA  "<span …     0.285   0.0472 0.0982     0.215   0.0372 6    
    ##  7 Buffalo, NY "<span …     0.714   0.211  0.351      0.619   0.194  7    
    ##  8 Charlotte,… "<span …     0.951   0.313  0.581      0.960   0.336  8    
    ##  9 Chicago, IL "<span …     0.734   0.432  0.482      0.623   0.373  9    
    ## 10 Cincinnati… "<span …     0.541   0.180  0.310      0.514   0.180  10   
    ## # ... with 37 more rows

\#
